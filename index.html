<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>صالون التميز - الحجز الفاخر</title>
  <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #00ffff;
      --accent: #00ffff;
      --text: #fff;
      --bg-dark: #000010;
      --input-bg: rgba(255,255,255,0.06);
      --error: #ff1744;
    }
    * {margin:0;padding:0;box-sizing:border-box;font-family:'Almarai',sans-serif;}
    body {background:linear-gradient(135deg,#000010,#03008a 60%,#000);color:var(--text);min-height:100vh;padding:15px;padding-bottom:80px;position:relative;-webkit-font-smoothing:antialiased;user-select:none;scroll-behavior:smooth;}
    body::before {content:"";position:fixed;top:0;left:0;width:200%;height:200%;background:radial-gradient(circle,rgba(0,255,255,0.15),transparent 70%);z-index:-1;animation:bgMove 15s infinite linear;}
    @keyframes bgMove {0%{transform:translate(-50%,-50%)}100%{transform:translate(-25%,-25%)}}
    .container {background:rgba(255,255,255,0.06);padding:28px 22px;border-radius:30px;border:2px solid rgba(0,255,255,0.35);box-shadow:inset 0 0 25px rgba(0,255,255,0.25),0 0 35px rgba(0,255,255,0.25);max-width:460px;width:100%;text-align:center;position:relative;backdrop-filter:blur(20px) saturate(180%);margin:20px auto;}
    h1 {color:var(--primary);margin-bottom:10px;font-size:1.9rem;font-weight:800;text-shadow:0 0 15px rgba(0,255,255,0.6),0 0 30px rgba(0,255,255,0.3);}
    .subtitle {color:#ccc;font-size:1rem;margin-bottom:24px;opacity:0.8;}
    label {display:block;margin-bottom:6px;color:var(--accent);font-weight:600;text-align:right;}
    input,select {width:100%;padding:14px 16px;border:2px solid var(--primary);border-radius:16px;background:var(--input-bg);color:var(--accent);font-size:1rem;transition:all .3s ease;margin-bottom:18px;appearance:none;}
    input.valid{border-color:var(--primary);box-shadow:0 0 10px rgba(0,255,255,0.3);}
    input.invalid{border-color:var(--error);box-shadow:0 0 10px rgba(255,23,68,0.3);}
    input::placeholder{color:rgba(0,255,255,0.5);}
    input:focus,select:focus{outline:none;border-color:#00ffff;box-shadow:0 0 20px rgba(0,255,255,0.4);transform:scale(1.02);}
    .error-message{color:var(--error);font-size:.85rem;margin-top:-12px;margin-bottom:15px;text-align:right;display:none;font-weight:600;}
    button[type=submit],.login-btn{background:linear-gradient(135deg,#00ffff,#00ffff);color:black;border:none;padding:15px 32px;font-size:1.15rem;font-weight:700;border-radius:20px;cursor:pointer;width:100%;transition:all .3s ease;box-shadow:0 0 20px rgba(0,255,255,0.3);margin-top:24px;}
    button[type=submit]:hover,.login-btn:hover{transform:scale(1.05);box-shadow:0 0 40px rgba(0,255,255,0.5);}
    .details-card{background:rgba(255,255,255,0.06);border:1.5px solid var(--primary);border-radius:16px;padding:22px;margin-top:18px;display:none;box-shadow:0 0 20px rgba(0,255,255,0.2);}
    .details-card h3{color:var(--accent);margin-bottom:14px;font-size:1.2rem;}
    .cancel-btn{background:#ff1744;color:white;padding:10px 24px;border:none;border-radius:10px;cursor:pointer;margin-top:16px;font-weight:600;}
    .cancel-btn:hover{background:#d50032;}
    .success-toast{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0.8);background:linear-gradient(135deg,#00ffff,#00ffff);color:black;padding:20px 28px;border-radius:18px;box-shadow:0 0 40px rgba(0,255,255,0.5);z-index:10000;text-align:center;font-weight:700;font-size:1.1rem;opacity:0;pointer-events:none;transition:all .4s ease;}
    .success-toast.show{opacity:1;transform:translate(-50%,-50%) scale(1);}
    select#hour{margin-bottom:28px!important;}
    
    /* شريط التنقل السفلي - بدون نصوص */
    .bottom-nav{position:fixed;bottom:15px;left:50%;transform:translateX(-50%);width:92%;max-width:480px;background:rgba(255,255,255,0.06);backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(0,255,255,0.3);border-radius:30px;display:flex;justify-content:space-around;padding:14px 0;z-index:100;box-shadow:0 -5px 30px rgba(0,0,0,0.4),0 0 20px rgba(0,255,255,0.2);}
    .nav-item{display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all .3s ease;padding:12px 20px;border-radius:20px;width:60px;height:60px;}
    .nav-item.active{background:rgba(0,255,255,0.15);box-shadow:0 0 20px rgba(0,255,255,0.4);}
    .nav-icon{width:36px;height:36px;object-fit:contain;filter:drop-shadow(0 0 6px rgba(0,255,255,0.4));transition:all .3s ease;}
    .nav-item.active .nav-icon{filter:drop-shadow(0 0 15px rgba(0,255,255,0.9));transform:scale(1.2);}
    /* إخفاء النصوص تماماً */
    .nav-label{display:none;}

    .hidden{display:none!important;}
    .phone-display{direction:ltr;text-align:center;font-weight:700;font-size:1.1rem;color:var(--accent);margin:8px 0;padding:6px 12px;background:rgba(0,255,255,0.1);border-radius:8px;border:1px solid var(--accent);}
    .booking-status{color:#22d97a;font-weight:700;margin:10px 0;padding:8px;background:rgba(34,217,122,0.1);border-radius:8px;border:1px solid #22d97a;}
    .bookings-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,#000010,#03008a 60%,#000);z-index:200;display:none;flex-direction:column;padding:20px;overflow-y:auto;padding-bottom:80px;}
    .bookings-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;}
    .bookings-title{color:var(--primary);font-size:1.8rem;}
    .booking-item{background:rgba(255,255,255,0.06);border-radius:16px;padding:20px;border:1.5px solid var(--primary);margin-bottom:15px;box-shadow:0 0 15px rgba(0,255,255,0.2);}
    .no-bookings{text-align:center;color:#ccc;margin-top:50px;font-size:1.1rem;}
    .active-booking-banner{background:rgba(0,255,255,0.1);border:1px solid var(--primary);border-radius:12px;padding:15px;margin-bottom:20px;text-align:center;color:var(--primary);font-weight:600;cursor:pointer;}
    .screen{display:none;width:100%;min-height:calc(100vh - 80px);padding:20px;padding-bottom:0;}
    .screen.active{display:flex;flex-direction:column;align-items:center;justify-content:flex-start;}
    .confirmation-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);display:none;justify-content:center;align-items:center;z-index:1000;}
    .confirmation-content{background:rgba(255,255,255,0.06);padding:25px;border-radius:18px;border:2px solid rgba(0,255,255,0.35);box-shadow:0 0 30px rgba(0,255,255,0.4);text-align:center;max-width:350px;width:90%;}
    .confirmation-buttons{display:flex;justify-content:space-between;gap:15px;margin-top:20px;}
    .confirm-yes,.confirm-no{flex:1;padding:12px;border:none;border-radius:10px;font-weight:700;cursor:pointer;}
    .confirm-yes{background:linear-gradient(135deg,#22d97a,#00ffff);color:white;}
    .confirm-no{background:#ff1744;color:white;}
    .booking-cancel-btn{background:#ff1744;color:white;border:none;padding:8px 16px;border-radius:8px;cursor:pointer;font-weight:600;margin-top:10px;transition:all .3s ease;}
    .booking-cancel-btn:hover{background:#d50032;transform:scale(1.05);}
  </style>
</head>
<body>

  <!-- شاشة الحجز الرئيسية -->
  <div id="mainScreen" class="screen active">
    <div class="container">
      <h1>صالون التميز</h1>
      <p class="subtitle">تجربة فاخرة بلمسة تقنية</p>

      <div id="detailsCard" class="details-card"></div>

      <form id="bookingForm">
        <label for="name">الاسم الكامل</label>
        <input type="text" id="name" required placeholder="أدخل اسمك الكامل (أحرف عربية فقط - من 7 إلى 50 حرف)">
        <div class="error-message" id="nameError">الاسم يجب أن يحتوي على أحرف عربية فقط وبين 7 و50 حرف</div>

        <label for="phone">رقم الموبايل</label>
        <input type="tel" id="phone" required placeholder="أدخل رقم الموبايل (11 رقم فقط)">
        <div class="error-message" id="phoneError">رقم الموبايل يجب أن يحتوي على 11 رقم فقط</div>

        <label for="service">نوع الخدمة</label>
        <select id="service" required>
          <option value="">اختر الخدمة</option>
          <option value="قص شعر VIP">قص شعر VIP</option>
          <option value="حلاقة ذقن ملكية">حلاقة ذقن ملكية</option>
          <option value="صبغة فاخرة">صبغة فاخرة</option>
          <option value="عناية بالبشرة">عناية بالبشرة</option>
        </select>

        <label for="day">اختر اليوم</label>
        <select id="day" required></select>

        <label for="hour">اختر الساعة</label>
        <select id="hour" required></select>

        <button type="submit" id="submitBtn">احجز الآن</button>
      </form>
    </div>
  </div>

  <!-- شاشة الحجوزات -->
  <div id="bookingsScreen" class="screen">
    <div class="container">
      <div class="bookings-header">
        <h2 class="bookings-title">حجوزاتي</h2>
      </div>

      <div id="activeBookingBanner" class="active-booking-banner hidden">
        لديك حجز نشط - اضغط لعرض التفاصيل
      </div>

      <div id="bookingsList"></div>

      <div id="noBookingsMessage" class="no-bookings hidden">
        <p>لا توجد حجوزات حالياً</p>
      </div>
    </div>
  </div>

  <!-- شريط التنقل السفلي - فقط أيقونات بدون نصوص -->
  <div class="bottom-nav" id="bottomNav">
    <div class="nav-item active" id="navHome">
      <img src="hume-button.png" class="nav-icon" alt="الرئيسية" loading="lazy">
    </div>
    <div class="nav-item" id="navBookings">
      <img src="order-history.png" class="nav-icon" alt="حجوزاتي" loading="lazy">
    </div>
  </div>

  <!-- نافذة تأكيد الإلغاء -->
  <div id="confirmationModal" class="confirmation-modal">
    <div class="confirmation-content">
      <h3 style="color:var(--primary);margin-bottom:15px;">تأكيد الإلغاء</h3>
      <p class="confirmation-text">هل أنت متأكد من إلغاء هذا الحجز؟</p>
      <div class="confirmation-buttons">
        <button class="confirm-yes" id="confirmYes">نعم</button>
        <button class="confirm-no" id="confirmNo">لا</button>
      </div>
    </div>
  </div>

  <div id="successToast" class="success-toast"></div>

  <!-- Firebase + JavaScript -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getDatabase, ref, onValue, set, remove } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyALYto6lJvO0qrne3mL1zz2jBdlgnA4-nA",
      authDomain: "salonbookingsystem-d2296.firebaseapp.com",
      databaseURL: "https://salonbookingsystem-d2296-default-rtdb.firebaseio.com",
      projectId: "salonbookingsystem-d2296",
      storageBucket: "salonbookingsystem-d2296.firebasestorage.app",
      messagingSenderId: "51763851442",
      appId: "1:51763851442:web:3ebd2e1c6d84a24ac119ab"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // باقي الجافا سكريبت زي ما هو تماماً (ما غيرتش فيه حاجة)
    // ... (كل الكود الأصلي من غير تغيير)
    // أنا هحطه كامل تحت عشان ما يحصلش أي خطأ

    const mainScreen = document.getElementById("mainScreen");
    const bookingsScreen = document.getElementById("bookingsScreen");
    const navHome = document.getElementById("navHome");
    const navBookings = document.getElementById("navBookings");
    const bookingsList = document.getElementById("bookingsList");
    const noBookingsMessage = document.getElementById("noBookingsMessage");
    const activeBookingBanner = document.getElementById("activeBookingBanner");
    const confirmationModal = document.getElementById("confirmationModal");
    const confirmYes = document.getElementById("confirmYes");
    const confirmNo = document.getElementById("confirmNo");
    const toast = document.getElementById("successToast");
    const details = document.getElementById("detailsCard");
    const form = document.getElementById("bookingForm");
    const nameInput = document.getElementById("name");
    const phoneInput = document.getElementById("phone");
    const nameError = document.getElementById("nameError");
    const phoneError = document.getElementById("phoneError");
    const daysSelect = document.getElementById("day");
    const hoursSelect = document.getElementById("hour");

    const days = ["الأحد","الإثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"];
    let currentUser = JSON.parse(localStorage.getItem("currentUser")) || null;
    let myBooking = JSON.parse(localStorage.getItem("myBooking")) || null;
    let bookingToCancel = null;
    let currentBookings = {};

    function isValidName(n) { return /^[\u0600-\u06FF\s]{7,50}$/.test(n.trim()); }
    function isValidPhone(p) { return /^[0-9]{11}$/.test(p); }

    nameInput.addEventListener("input", () => {
      const v = nameInput.value;
      if (v && !isValidName(v)) { nameInput.classList.add("invalid"); nameError.style.display = "block"; }
      else { nameInput.classList.remove("invalid"); nameInput.classList.add("valid"); nameError.style.display = "none"; }
    });
    phoneInput.addEventListener("input", () => {
      const v = phoneInput.value;
      if (v && !isValidPhone(v)) { phoneInput.classList.add("invalid"); phoneError.style.display = "block"; }
      else { phoneInput.classList.remove("invalid"); phoneInput.classList.add("valid"); phoneError.style.display = "none"; }
    });
    nameInput.addEventListener("keydown", e => { if (/[0-9]/.test(e.key)) e.preventDefault(); });
    phoneInput.addEventListener("keydown", e => { if (!/[0-9]|Backspace|Delete|ArrowLeft|ArrowRight|Tab/.test(e.key)) e.preventDefault(); });

    function showToast(msg) {
      toast.textContent = msg;
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 3000);
    }

    function showMainScreen() {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      mainScreen.classList.add('active');
      document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
      navHome.classList.add('active');
      populateDays(); populateHours();
    }

    function showBookingsScreen() {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      bookingsScreen.classList.add('active');
      document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
      navBookings.classList.add('active');
      loadUserBookings();
      if (myBooking) {
        activeBookingBanner.classList.remove("hidden");
        activeBookingBanner.onclick = () => showDetails(myBooking);
      } else {
        activeBookingBanner.classList.add("hidden");
      }
    }

    navHome.addEventListener("click", showMainScreen);
    navBookings.addEventListener("click", showBookingsScreen);

    function populateDays() {
      daysSelect.innerHTML = "<option value=''>اختر اليوم</option>";
      const today = new Date();
      for (let i = 0; i < 7; i++) {
        const d = new Date(); d.setDate(today.getDate() + i);
        const val = d.toISOString().slice(0, 10);
        const opt = document.createElement("option");
        opt.value = val;
        opt.textContent = `${days[d.getDay()]} (${d.getDate()}/${d.getMonth() + 1})`;
        daysSelect.appendChild(opt);
      }
    }

    function populateHours() {
      hoursSelect.innerHTML = "<option value=''>اختر الساعة</option>";
      for (let h = 9; h <= 21; h++) {
        const opt = document.createElement("option");
        opt.value = `${h}:00`;
        opt.textContent = `${h}:00`;
        hoursSelect.appendChild(opt);
      }
    }

    const bookingsRef = ref(db, "bookings");
    onValue(bookingsRef, snap => {
      currentBookings = snap.val() || {};
      updateHours();
      if (myBooking && !currentBookings[myBooking.slotKey]) {
        showToast("تم إلغاء حجزك بواسطة الصالون");
        localStorage.removeItem("myBooking");
        myBooking = null;
        details.style.display = "none";
        activeBookingBanner.classList.add("hidden");
      }
    });

    function updateHours() {
      const selectedDay = daysSelect.value;
      if (!selectedDay) return;
      const now = new Date();
      const todayISO = now.toISOString().slice(0, 10);
      hoursSelect.querySelectorAll("option").forEach(opt => {
        if (!opt.value) return;
        const key = `${selectedDay}_${opt.value}`;
        const [hour] = opt.value.split(":");
        const isPast = (selectedDay === todayISO && parseInt(hour) <= now.getHours());
        opt.disabled = currentBookings[key] || isPast;
        opt.style.opacity = opt.disabled ? ".4" : "1";
      });
    }
    daysSelect.addEventListener("change", updateHours);

    form.addEventListener("submit", async e => {
      e.preventDefault();

      const name = nameInput.value.trim();
      const phone = phoneInput.value.trim();
      const service = document.getElementById("service").value;
      const day = daysSelect.value;
      const hour = hoursSelect.value;

      if (!isValidName(name)) { showToast("اسم غير صالح"); return; }
      if (!isValidPhone(phone)) { showToast("رقم جوال غير صالح"); return; }
      if (!service || !day || !hour) { showToast("يرجى ملء جميع الحقول"); return; }

      const slotKey = `${day}_${hour}`;
      if (currentBookings[slotKey]) {
        showToast("عذرًا، هذا الموعد محجوز");
        return;
      }

      const bookingId = Date.now().toString();
      currentUser = { name, phone, userId: Date.now().toString() };
      localStorage.setItem("currentUser", JSON.stringify(currentUser));

      await set(ref(db, `bookings/${slotKey}/${bookingId}`), {
        name, phone, service, day, hour,
        timestamp: new Date().toISOString(),
        userId: currentUser.userId
      });

      myBooking = { name, phone, service, day, hour, slotKey, bookingId };
      localStorage.setItem("myBooking", JSON.stringify(myBooking));

      showToast("تم الحجز بنجاح!");

      setTimeout(() => {
        showBookingsScreen();
        showDetails(myBooking);
      }, 1500);

      form.reset();
      populateDays();
      populateHours();
    });

    function showDetails(b) {
      const d = new Date(b.day);
      details.innerHTML = `
        <h3>تفاصيل الحجز</h3>
        <p><b>الاسم:</b> ${b.name}</p>
        <div class="phone-display">${b.phone}</div>
        <p><b>الخدمة:</b> ${b.service}</p>
        <p><b>اليوم:</b> ${days[d.getDay()]} (${d.getDate()}/${d.getMonth() + 1})</p>
        <p><b>الساعة:</b> ${b.hour}</p>
        <div class="booking-status">موعد قادم</div>
        <button class="cancel-btn" id="cancelBtn">إلغاء الحجز</button>
      `;
      details.style.display = "block";
      document.getElementById("cancelBtn").onclick = () => showCancelConfirmation(b);
    }

    function showCancelConfirmation(booking) {
      bookingToCancel = booking;
      confirmationModal.style.display = "flex";
    }

    function hideCancelConfirmation() {
      confirmationModal.style.display = "none";
      bookingToCancel = null;
    }

    confirmYes.onclick = async () => {
      if (!bookingToCancel) return;
      await remove(ref(db, `bookings/${bookingToCancel.slotKey}/${bookingToCancel.bookingId}`));
      if (myBooking && myBooking.bookingId === bookingToCancel.bookingId) {
        localStorage.removeItem("myBooking");
        myBooking = null;
        activeBookingBanner.classList.add("hidden");
      }
      showToast("تم إلغاء الحجز");
      hideCancelConfirmation();
      loadUserBookings();
      updateHours();
    };

    confirmNo.onclick = hideCancelConfirmation;

    function loadUserBookings() {
      bookingsList.innerHTML = "";
      if (!currentBookings || Object.keys(currentBookings).length === 0) {
        noBookingsMessage.classList.remove("hidden");
        return;
      }

      const userBookings = [];
      for (const slotKey in currentBookings) {
        for (const bookingId in currentBookings[slotKey]) {
          const b = currentBookings[slotKey][bookingId];
          if (b.userId === currentUser?.userId) {
            const [dayISO, time] = slotKey.split("_");
            userBookings.push({ ...b, slotKey, bookingId, dayISO, time });
          }
        }
      }

      if (userBookings.length === 0) {
        noBookingsMessage.classList.remove("hidden");
        return;
      }

      noBookingsMessage.classList.add("hidden");

      userBookings.forEach(booking => {
        const d = new Date(booking.dayISO);
        const isActive = myBooking && myBooking.bookingId === booking.bookingId;
        const item = document.createElement("div");
        item.className = "booking-item";
        item.innerHTML = `
          <p><b>الاسم:</b> ${booking.name}</p>
          <p><b>الجوال:</b> ${booking.phone}</p>
          <p><b>الخدمة:</b> ${booking.service}</p>
          <p><b>اليوم:</b> ${days[d.getDay()]} (${d.getDate()}/${d.getMonth()+1})</p>
          <p><b>الساعة:</b> ${booking.time}</p>
          ${isActive ? '<div class="booking-status">موعد قادم</div>' : ''}
          <button class="booking-cancel-btn" data-b='${JSON.stringify(booking)}'>إلغاء الحجز</button>
        `;
        item.querySelector('.booking-cancel-btn').onclick = function() {
          const data = JSON.parse(this.getAttribute('data-b'));
          showCancelConfirmation(data);
        };
        bookingsList.appendChild(item);
      });
    }

    populateDays();
    populateHours();
  </script>
</body>
</html>
