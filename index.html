<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ØµØ§Ù„ÙˆÙ† - Ø§Ù„Ø­Ø¬Ø² Ø§Ù„ÙØ§Ø®Ø±</title>
  <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #00ffff; /* Ø£Ø²Ø±Ù‚ Ø³Ù…Ø§ÙˆÙŠ ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ */
      --accent: #00ffff;  /* Ø£Ø²Ø±Ù‚ Ø³Ù…Ø§ÙˆÙŠ */
      --text: #fff;
      --bg-dark: #000010;
      --input-bg: rgba(255,255,255,0.06);
      --error: #ff1744;   /* Ù„ÙˆÙ† Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø·Ø£ */
      --success: #22d97a; /* Ù„ÙˆÙ† Ø§Ù„Ù†Ø¬Ø§Ø­ */
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Almarai', sans-serif;
    }

    body {
      background: linear-gradient(135deg, #000010, #03008a 60%, #000);
      color: var(--text);
      min-height: 100vh;
      padding: 15px;
      padding-bottom: 80px; /* Ù…Ø³Ø§Ø­Ø© Ù„Ù„Ø¯ÙˆÙƒ */
      position: relative;
      -webkit-font-smoothing: antialiased;
      user-select: none;
      scroll-behavior: smooth;
    }

    body::before {
      content: "";
      position: fixed;
      top: 0; left: 0;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(0,255,255,0.15), transparent 70%);
      z-index: -1;
      animation: bgMove 15s infinite linear;
    }

    @keyframes bgMove {
      0% { transform: translate(-50%, -50%); }
      100% { transform: translate(-25%, -25%); }
    }

    .container {
      background: rgba(255, 255, 255, 0.06);
      padding: 28px 22px;
      border-radius: 30px;
      border: 2px solid rgba(0,255,255,0.35);
      box-shadow: 
        inset 0 0 25px rgba(0,255,255,0.25),
        0 0 35px rgba(0,255,255,0.25);
      max-width: 460px;
      width: 100%;
      text-align: center;
      position: relative;
      backdrop-filter: blur(20px) saturate(180%);
      margin: 20px auto;
    }

    h1 {
      color: var(--primary);
      margin-bottom: 10px;
      font-size: 1.9rem;
      font-weight: 800;
      text-shadow: 0 0 15px rgba(0,255,255,0.6), 0 0 30px rgba(0,255,255,0.3);
    }

    .subtitle {
      color: #ccc;
      font-size: 1rem;
      margin-bottom: 24px;
      opacity: 0.8;
    }

    label {
      display: block;
      margin-bottom: 6px;
      color: var(--accent);
      font-weight: 600;
      text-align: right;
    }

    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø®Ø§Ù†Ø§Øª Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
    input, select {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid var(--primary);
      border-radius: 16px; /* Ø²ÙˆØ§ÙŠØ§ Ø¯Ø§Ø¦Ø±ÙŠØ© Ù…ØªÙ†Ø§Ø³Ù‚Ø© */
      background: var(--input-bg);
      color: var(--accent);
      font-size: 1rem;
      transition: all 0.3s ease;
      margin-bottom: 18px;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
    }

    /* ØªØ­Ø³ÙŠÙ† Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø®ØªÙ„ÙØ© - Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø®Ø¶Ø± */
    input.valid {
      border-color: var(--primary);
      box-shadow: 0 0 10px rgba(0,255,255,0.3);
    }

    input.invalid {
      border-color: var(--error);
      box-shadow: 0 0 10px rgba(255,23,68,0.3);
    }

    input::placeholder {
      color: rgba(0,255,255,0.5);
    }

    input:focus, select:focus {
      outline: none;
      border-color: #00ffff;
      box-shadow: 0 0 20px rgba(0,255,255,0.4);
      transform: scale(1.02);
    }

    /* Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø·Ø£ */
    .error-message {
      color: var(--error);
      font-size: 0.85rem;
      margin-top: -12px;
      margin-bottom: 15px;
      text-align: right;
      display: none;
      font-weight: 600;
    }

    .char-counter {
      color: var(--accent);
      font-size: 0.8rem;
      text-align: left;
      margin-top: -15px;
      margin-bottom: 15px;
      direction: ltr;
    }

    button[type="submit"], .login-btn {
      background: linear-gradient(135deg, #00ffff, #00ffff);
      color: black;
      border: none;
      padding: 15px 32px;
      font-size: 1.15rem;
      font-weight: 700;
      border-radius: 20px; /* Ø²ÙˆØ§ÙŠØ§ Ø¯Ø§Ø¦Ø±ÙŠØ© Ù…ØªÙ†Ø§Ø³Ù‚Ø© */
      cursor: pointer;
      width: 100%;
      transition: all 0.3s ease;
      box-shadow: 0 0 20px rgba(0,255,255,0.3);
      margin-top: 24px;
    }

    button[type="submit"]:hover, .login-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 0 40px rgba(0,255,255,0.5);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: 0 0 10px rgba(0,255,255,0.2) !important;
    }

    .booking-info {
      margin: 16px 0 8px;
      padding: 12px;
      border-radius: 12px; /* Ø²ÙˆØ§ÙŠØ§ Ø¯Ø§Ø¦Ø±ÙŠØ© Ù…ØªÙ†Ø§Ø³Ù‚Ø© */
      font-weight: 600;
      background: rgba(0,255,255,0.1);
      border: 1px solid var(--primary);
      color: var(--primary);
      cursor: pointer;
      display: none;
    }

    .details-card {
      background: rgba(255,255,255,0.06);
      border: 1.5px solid var(--primary);
      border-radius: 16px; /* Ø²ÙˆØ§ÙŠØ§ Ø¯Ø§Ø¦Ø±ÙŠØ© Ù…ØªÙ†Ø§Ø³Ù‚Ø© */
      padding: 22px;
      margin-top: 18px;
      display: none;
      box-shadow: 0 0 20px rgba(0,255,255,0.2);
    }

    .details-card h3 {
      color: var(--accent);
      margin-bottom: 14px;
      font-size: 1.2rem;
    }

    .cancel-btn {
      background: #ff1744;
      color: white;
      padding: 10px 24px;
      border: none;
      border-radius: 10px; /* Ø²ÙˆØ§ÙŠØ§ Ø¯Ø§Ø¦Ø±ÙŠØ© Ù…ØªÙ†Ø§Ø³Ù‚Ø© */
      cursor: pointer;
      margin-top: 16px;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .cancel-btn:hover {
      background: #d50032;
    }

    .success-toast {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.8);
      background: linear-gradient(135deg, #00ffff, #00ffff);
      color: black;
      padding: 20px 28px;
      border-radius: 18px; /* Ø²ÙˆØ§ÙŠØ§ Ø¯Ø§Ø¦Ø±ÙŠØ© Ù…ØªÙ†Ø§Ø³Ù‚Ø© */
      box-shadow: 0 0 40px rgba(0,255,255,0.5);
      z-index: 10000;
      text-align: center;
      font-weight: 700;
      font-size: 1.1rem;
      opacity: 0;
      pointer-events: none;
      transition: all 0.4s ease;
    }

    .success-toast.show {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }

    select#hour {
      margin-bottom: 28px !important;
    }

    /* Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
    .login-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #000010, #03008a 60%, #000);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .login-container {
      background: rgba(255,255,255,0.06);
      padding: 30px;
      border-radius: 20px; /* Ø²ÙˆØ§ÙŠØ§ Ø¯Ø§Ø¦Ø±ÙŠØ© Ù…ØªÙ†Ø§Ø³Ù‚Ø© */
      border: 2px solid rgba(0,255,255,0.35);
      box-shadow: 
        inset 0 0 25px rgba(0,255,255,0.25),
        0 0 35px rgba(0,255,255,0.25);
      max-width: 400px;
      width: 90%;
      text-align: center;
      backdrop-filter: blur(20px) saturate(180%);
    }

    .login-title {
      font-size: 2.5rem;
      margin-bottom: 20px;
      color: var(--primary);
      text-shadow: 0 0 15px rgba(0,255,255,0.6);
      font-weight: 800;
    }

    /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ - ØªØµÙ…ÙŠÙ… iOS */
    .bottom-nav {
      position: fixed;
      bottom: 15px;
      left: 50%;
      transform: translateX(-50%);
      width: 92%; /* Ø£Ù‚Ù„ Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù…Ù† Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ§Ø±Ø¯ */
      max-width: 480px; /* Ø£Ù‚Ù„ Ø¨Ù€ 30px Ù…Ù† Ø§Ù„ÙƒØ§Ø±Ø¯ (460px) */
      background: rgba(255,255,255,0.06);
      backdrop-filter: blur(20px) saturate(180%);
      border: 1px solid rgba(0,255,255,0.3);
      border-radius: 30px; /* Ø²ÙˆØ§ÙŠØ§ Ø¯Ø§Ø¦Ø±ÙŠØ© Ù…ØªÙ†Ø§Ø³Ù‚Ø© */
      display: flex;
      justify-content: space-around;
      padding: 10px 0; /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø¨Ø§Ø¯ÙŠÙ†Ø¬ Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
      z-index: 100;
      box-shadow: 0 -5px 30px rgba(0,0,0,0.4), 0 0 20px rgba(0,255,255,0.2);
      margin: 0 auto;
    }

    /* ØªØ­Ø³ÙŠÙ† Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
    @media (max-width: 480px) {
      .bottom-nav {
        width: 90%; /* Ø£Ù‚Ù„ Ø¹Ø±Ø¶ ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
        max-width: 400px;
        padding: 8px 0;
      }
      
      .nav-item {
        padding: 6px 12px; /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø¨Ø§Ø¯ÙŠÙ†Ø¬ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ */
      }
      
      .nav-icon {
        font-size: 1.5rem; /* ØªØµØºÙŠØ± Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
      }
    }

    /* ØªØ­Ø³ÙŠÙ† Ø®Ø§Øµ Ù„Ù€ iPhone 4S ÙˆØ£Ø¬Ù‡Ø²Ø© ØµØºÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ */
    @media (max-width: 320px) {
      .bottom-nav {
        width: 88%;
        max-width: 380px;
        bottom: 10px;
        padding: 6px 0;
      }
      
      .nav-item {
        padding: 4px 8px;
      }
      
      .nav-icon {
        font-size: 1.3rem;
      }
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      color: var(--text);
      font-size: 0;
      cursor: pointer;
      transition: all 0.3s ease;
      padding: 8px 16px;
      border-radius: 20px; /* Ø²ÙˆØ§ÙŠØ§ Ø¯Ø§Ø¦Ø±ÙŠØ© Ù…ØªÙ†Ø§Ø³Ù‚Ø© */
    }

    .nav-item.active {
      color: var(--primary);
      background: rgba(0,255,255,0.1);
    }

    .nav-icon {
      width: 24px;
      height: 24px;
      margin-bottom: 4px;
      filter: drop-shadow(0 0 5px rgba(0,255,255,0.3));
      object-fit: contain;
    }

    .nav-label {
      font-size: 0.75rem;
      margin-top: 2px;
    }

    /* Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ */
    .profile-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #000010, #03008a 60%, #000);
      z-index: 200;
      display: none;
      flex-direction: column;
      padding: 20px;
      overflow-y: auto;
      padding-bottom: 80px; /* Ù…Ø³Ø§Ø­Ø© Ù„Ù„Ø¯ÙˆÙƒ */
    }

    .profile-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }

    .profile-title {
      color: var(--primary);
      font-size: 1.8rem;
    }

    .close-btn {
      background: none;
      border: none;
      color: var(--text);
      font-size: 1.5rem;
      cursor: pointer;
    }

    .profile-card {
      background: rgba(255,255,255,0.06);
      border-radius: 18px; /* Ø²ÙˆØ§ÙŠØ§ Ø¯Ø§Ø¦Ø±ÙŠØ© Ù…ØªÙ†Ø§Ø³Ù‚Ø© */
      padding: 25px;
      border: 2px solid rgba(0,255,255,0.35);
      box-shadow: 0 0 20px rgba(0,255,255,0.2);
      margin-bottom: 20px;
    }

    .profile-info {
      margin-bottom: 15px;
    }

    .profile-info label {
      color: var(--accent);
      font-weight: 600;
      margin-bottom: 5px;
    }

    .profile-info p {
      color: var(--text);
      font-size: 1.1rem;
      margin-bottom: 15px;
    }

    .edit-btn {
      background: linear-gradient(135deg, #00ffff, #00ffff);
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 1rem;
      font-weight: 700;
      border-radius: 12px; /* Ø²ÙˆØ§ÙŠØ§ Ø¯Ø§Ø¦Ø±ÙŠØ© Ù…ØªÙ†Ø§Ø³Ù‚Ø© */
      cursor: pointer;
      width: 100%;
      transition: all 0.3s ease;
      box-shadow: 0 0 15px rgba(0,255,255,0.3);
      margin-top: 10px;
    }

    .edit-btn:hover {
      transform: scale(1.03);
      box-shadow: 0 0 25px rgba(0,255,255,0.5);
    }

    .hidden {
      display: none !important;
    }

    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© */
    .phone-display {
      direction: ltr;
      text-align: center;
      font-weight: 700;
      font-size: 1.1rem;
      color: var(--accent);
      margin: 8px 0;
      padding: 6px 12px;
      background: rgba(0, 255, 255, 0.1);
      border-radius: 8px; /* Ø²ÙˆØ§ÙŠØ§ Ø¯Ø§Ø¦Ø±ÙŠØ© Ù…ØªÙ†Ø§Ø³Ù‚Ø© */
      border: 1px solid var(--accent);
    }

    .booking-status {
      color: #22d97a;
      font-weight: 700;
      margin: 10px 0;
      padding: 8px;
      background: rgba(34, 217, 122, 0.1);
      border-radius: 8px; /* Ø²ÙˆØ§ÙŠØ§ Ø¯Ø§Ø¦Ø±ÙŠØ© Ù…ØªÙ†Ø§Ø³Ù‚Ø© */
      border: 1px solid #22d97a;
    }

    /* Ø´Ø§Ø´Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª */
    .bookings-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #000010, #03008a 60%, #000);
      z-index: 200;
      display: none;
      flex-direction: column;
      padding: 20px;
      overflow-y: auto;
      padding-bottom: 80px; /* Ù…Ø³Ø§Ø­Ø© Ù„Ù„Ø¯ÙˆÙƒ */
    }

    .bookings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }

    .bookings-title {
      color: var(--primary);
      font-size: 1.8rem;
    }

    .booking-item {
      background: rgba(255,255,255,0.06);
      border-radius: 16px; /* Ø²ÙˆØ§ÙŠØ§ Ø¯Ø§Ø¦Ø±ÙŠØ© Ù…ØªÙ†Ø§Ø³Ù‚Ø© */
      padding: 20px;
      border: 1.5px solid var(--primary);
      margin-bottom: 15px;
      box-shadow: 0 0 15px rgba(0,255,255,0.2);
      position: relative;
    }

    .no-bookings {
      text-align: center;
      color: #ccc;
      margin-top: 50px;
      font-size: 1.1rem;
    }

    /* Ø²Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª */
    .confirm-btn {
      background: linear-gradient(135deg, #22d97a, #00ffff);
      color: white;
      border: none;
      padding: 12px;
      font-size: 1.2rem;
      border-radius: 50%; /* Ø¯Ø§Ø¦Ø±ÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ */
      cursor: pointer;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 10px auto;
      box-shadow: 0 0 20px rgba(34,217,122,0.4);
      transition: all 0.3s ease;
    }

    .confirm-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 0 30px rgba(34,217,122,0.6);
    }

    /* Ø²Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙÙŠ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ */
    .settings-btn {
      position: absolute;
      bottom: 90px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #00ffff, #00ffff);
      color: white;
      border: none;
      padding: 15px;
      font-size: 1.5rem;
      border-radius: 50%; /* Ø¯Ø§Ø¦Ø±ÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ */
      cursor: pointer;
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 25px rgba(0,255,255,0.5);
      transition: all 0.3s ease;
      z-index: 10;
    }

    .settings-btn:hover {
      transform: translateX(-50%) scale(1.1);
      box-shadow: 0 0 35px rgba(0,255,255,0.7);
    }

    /* Ø²Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯ ÙÙŠ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ */
    .confirm-save-btn {
      position: absolute;
      bottom: 90px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #22d97a, #00ffff);
      color: white;
      border: none;
      padding: 15px;
      font-size: 1.5rem;
      border-radius: 50%; /* Ø¯Ø§Ø¦Ø±ÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ */
      cursor: pointer;
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 25px rgba(34,217,122,0.5);
      transition: all 0.3s ease;
      z-index: 10;
      display: none;
    }

    .confirm-save-btn:hover {
      transform: translateX(-50%) scale(1.1);
      box-shadow: 0 0 35px rgba(34,217,122,0.7);
    }

    /* Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ù†Ø´Ø· ÙÙŠ Ø´Ø§Ø´Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª */
    .active-booking-banner {
      background: rgba(0,255,255,0.1);
      border: 1px solid var(--primary);
      border-radius: 12px; /* Ø²ÙˆØ§ÙŠØ§ Ø¯Ø§Ø¦Ø±ÙŠØ© Ù…ØªÙ†Ø§Ø³Ù‚Ø© */
      padding: 15px;
      margin-bottom: 20px;
      text-align: center;
      color: var(--primary);
      font-weight: 600;
      cursor: pointer;
    }

    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ© */
    .screen {
      display: none;
      width: 100%;
      min-height: calc(100vh - 80px);
      padding: 20px;
      padding-bottom: 0;
    }

    .screen.active {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }

    /* Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ù„ØºØ§Ø¡ */
    .confirmation-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .confirmation-content {
      background: rgba(255,255,255,0.06);
      padding: 25px;
      border-radius: 18px;
      border: 2px solid rgba(0,255,255,0.35);
      box-shadow: 0 0 30px rgba(0,255,255,0.4);
      text-align: center;
      max-width: 350px;
      width: 90%;
    }

    .confirmation-text {
      color: var(--text);
      margin-bottom: 25px;
      font-size: 1.1rem;
    }

    .confirmation-buttons {
      display: flex;
      justify-content: space-between;
      gap: 15px;
    }

    .confirm-yes, .confirm-no {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .confirm-yes {
      background: linear-gradient(135deg, #22d97a, #00ffff);
      color: white;
    }

    .confirm-no {
      background: #ff1744;
      color: white;
    }

    .confirm-yes:hover, .confirm-no:hover {
      transform: scale(1.05);
    }

    /* Ø²Ø± Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¬Ø² ÙÙŠ Ø¹Ù†ØµØ± Ø§Ù„Ø­Ø¬Ø² */
    .booking-cancel-btn {
      background: #ff1744;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      margin-top: 10px;
      transition: all 0.3s ease;
    }

    .booking-cancel-btn:hover {
      background: #d50032;
      transform: scale(1.05);
    }

    /* Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ */
    .logout-btn {
      background: linear-gradient(135deg, #ff1744, #ff5252);
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 1rem;
      font-weight: 700;
      border-radius: 12px;
      cursor: pointer;
      width: 100%;
      transition: all 0.3s ease;
      box-shadow: 0 0 15px rgba(255,23,68,0.3);
      margin-top: 20px;
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      max-width: 85%;
    }

    .logout-btn:hover {
      transform: translateX(-50%) scale(1.03);
      box-shadow: 0 0 25px rgba(255,23,68,0.5);
    }

    /* Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
    .loading-indicator {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: var(--primary);
      font-size: 1.2rem;
      z-index: 10000;
      background: rgba(0,0,0,0.8);
      padding: 20px;
      border-radius: 10px;
      display: none;
    }

    .loading-indicator.show {
      display: block;
    }
  </style>
</head>
<body>
  <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <div id="loginScreen" class="login-screen">
    <div class="login-container">
      <h1 class="login-title">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</h1>
      <form id="loginForm">
        <label for="userName">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
        <input type="text" id="userName" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„ (Ø£Ø­Ø±Ù Ø¹Ø±Ø¨ÙŠØ© ÙÙ‚Ø· - Ù…Ù† 7 Ø¥Ù„Ù‰ 50 Ø­Ø±Ù)">
        <div class="char-counter" id="userNameCounter">0/50</div>
        <div class="error-message" id="userNameError">Ø§Ù„Ø§Ø³Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø­Ø±Ù Ø¹Ø±Ø¨ÙŠØ© ÙÙ‚Ø· ÙˆØ¨ÙŠÙ† 7 Ùˆ50 Ø­Ø±Ù</div>
        
        <label for="userPhone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
        <input type="tel" id="userPhone" required placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ (11 Ø±Ù‚Ù… ÙÙ‚Ø·)">
        <div class="char-counter" id="userPhoneCounter">0/11</div>
        <div class="error-message" id="userPhoneError">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ 11 Ø±Ù‚Ù… ÙÙ‚Ø·</div>
        
        <button type="submit" class="login-btn" id="loginBtn">Ù…ÙˆØ§ÙÙ‚</button>
      </form>
    </div>
  </div>

  <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
  <div id="mainScreen" class="screen active">
    <div class="container">
      <h1>ØµØ§Ù„ÙˆÙ† Ø§Ù„ØªÙ…ÙŠØ²</h1>
      <p class="subtitle">ØªØ¬Ø±Ø¨Ø© ÙØ§Ø®Ø±Ø© Ø¨Ù„Ù…Ø³Ø© ØªÙ‚Ù†ÙŠØ©</p>

      <!-- ØªÙ… Ø¥Ø®ÙØ§Ø¡ bookingInfo Ùˆ detailsCard Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
      <div id="detailsCard" class="details-card"></div>

      <form id="bookingForm">
        <label for="name">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
        <input type="text" id="name" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„ (Ø£Ø­Ø±Ù Ø¹Ø±Ø¨ÙŠØ© ÙÙ‚Ø· - Ù…Ù† 7 Ø¥Ù„Ù‰ 50 Ø­Ø±Ù)">
        <div class="char-counter" id="nameCounter">0/50</div>
        <div class="error-message" id="nameError">Ø§Ù„Ø§Ø³Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø­Ø±Ù Ø¹Ø±Ø¨ÙŠØ© ÙÙ‚Ø· ÙˆØ¨ÙŠÙ† 7 Ùˆ50 Ø­Ø±Ù</div>

        <label for="service">Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©</label>
        <select id="service" required>
          <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø®Ø¯Ù…Ø©</option>
          <option value="Ù‚Øµ Ø´Ø¹Ø± VIP">Ù‚Øµ Ø´Ø¹Ø± VIP</option>
          <option value="Ø­Ù„Ø§Ù‚Ø© Ø°Ù‚Ù† Ù…Ù„ÙƒÙŠØ©">Ø­Ù„Ø§Ù‚Ø© Ø°Ù‚Ù† Ù…Ù„ÙƒÙŠØ©</option>
          <option value="ØµØ¨ØºØ© ÙØ§Ø®Ø±Ø©">ØµØ¨ØºØ© ÙØ§Ø®Ø±Ø©</option>
          <option value="Ø¹Ù†Ø§ÙŠØ© Ø¨Ø§Ù„Ø¨Ø´Ø±Ø©">Ø¹Ù†Ø§ÙŠØ© Ø¨Ø§Ù„Ø¨Ø´Ø±Ø©</option>
        </select>

        <label for="day">Ø§Ø®ØªØ± Ø§Ù„ÙŠÙˆÙ…</label>
        <select id="day" required></select>

        <label for="hour">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø§Ø¹Ø©</label>
        <select id="hour" required></select>

        <button type="submit" id="submitBtn">Ø§Ø­Ø¬Ø² Ø§Ù„Ø¢Ù†</button>
      </form>
    </div>
  </div>

  <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ -->
  <div id="profileScreen" class="screen">
    <div class="container">
      <div class="profile-header">
        <h2 class="profile-title">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h2>
      </div>
      
      <div class="profile-card">
        <div class="profile-info">
          <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
          <p id="profileName"></p>
          
          <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
          <p id="profilePhone" class="phone-display"></p>
        </div>
        
        <div id="editProfileForm" class="hidden">
          <h3 style="color: var(--accent); margin-bottom: 20px;">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
          <form id="updateProfileForm">
            <label for="editName">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
            <input type="text" id="editName" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„ (Ø£Ø­Ø±Ù Ø¹Ø±Ø¨ÙŠØ© ÙÙ‚Ø· - Ù…Ù† 7 Ø¥Ù„Ù‰ 50 Ø­Ø±Ù)">
            <div class="char-counter" id="editNameCounter">0/50</div>
            <div class="error-message" id="editNameError">Ø§Ù„Ø§Ø³Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø­Ø±Ù Ø¹Ø±Ø¨ÙŠØ© ÙÙ‚Ø· ÙˆØ¨ÙŠÙ† 7 Ùˆ50 Ø­Ø±Ù</div>
            
            <label for="editPhone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
            <input type="tel" id="editPhone" required placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ (11 Ø±Ù‚Ù… ÙÙ‚Ø·)">
            <div class="char-counter" id="editPhoneCounter">0/11</div>
            <div class="error-message" id="editPhoneError">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ 11 Ø±Ù‚Ù… ÙÙ‚Ø·</div>
            
            <button type="button" class="confirm-btn" id="confirmEdit">âœ“</button>
          </form>
        </div>
      </div>
      
      <!-- Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ -->
      <button class="logout-btn" id="logoutBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
      
      <!-- Ø²Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙÙŠ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ -->
      <button class="settings-btn" id="settingsBtn">âš™ï¸</button>
      
      <!-- Ø²Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯ ÙÙŠ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ -->
      <button class="confirm-save-btn" id="confirmSaveBtn">âœ“</button>
    </div>
  </div>

  <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª -->
  <div id="bookingsScreen" class="screen">
    <div class="container">
      <div class="bookings-header">
        <h2 class="bookings-title">Ø­Ø¬ÙˆØ²Ø§ØªÙŠ</h2>
      </div>
      
      <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ù†Ø´Ø· (ØªØ¸Ù‡Ø± ÙÙ‚Ø· ÙÙŠ Ø´Ø§Ø´Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª) -->
      <div id="activeBookingBanner" class="active-booking-banner hidden">
        Ù„Ø¯ÙŠÙƒ Ø­Ø¬Ø² Ù†Ø´Ø· - Ø§Ø¶ØºØ· Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
      </div>
      
      <div id="bookingsList">
        <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ù‡Ù†Ø§ -->
      </div>
      
      <div id="noBookingsMessage" class="no-bookings hidden">
        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>
      </div>
    </div>
  </div>

  <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ -->
  <div class="bottom-nav" id="bottomNav">
    <div class="nav-item active" data-route="/" id="navHome">
      <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
      <img src="home-button.png" alt="Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©" class="nav-icon">
      <span class="nav-label">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
    </div>

    <div class="nav-item" data-route="/bookings" id="navBookings">
      <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª -->
      <img src="order-history.png" alt="Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª" class="nav-icon">
      <span class="nav-label">Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</span>
    </div>

    <div class="nav-item" data-route="/profile" id="navProfile">
      <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ -->
      <img src="profile.png" alt="Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ" class="nav-icon">
      <span class="nav-label">Ø§Ù„Ù…Ù„Ù</span>
    </div>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ù„ØºØ§Ø¡ -->
  <div id="confirmationModal" class="confirmation-modal">
    <div class="confirmation-content">
      <h3 style="color: var(--primary); margin-bottom: 15px;">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ù„ØºØ§Ø¡</h3>
      <p class="confirmation-text">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø¥Ù„ØºØ§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø²ØŸ</p>
      <div class="confirmation-buttons">
        <button class="confirm-yes" id="confirmYes">âœ“ Ù†Ø¹Ù…</button>
        <button class="confirm-no" id="confirmNo">âœ— Ù„Ø§</button>
      </div>
    </div>
  </div>

  <!-- Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
  <div id="loadingIndicator" class="loading-indicator">
    Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
  </div>

  <div id="successToast" class="success-toast"></div>

  <!-- Firebase Script -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getDatabase, ref, onValue, set, remove } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyALYto6lJvO0qrne3mL1zz2jBdlgnA4-nA",
      authDomain: "salonbookingsystem-d2296.firebaseapp.com",
      databaseURL: "https://salonbookingsystem-d2296-default-rtdb.firebaseio.com",
      projectId: "salonbookingsystem-d2296",
      storageBucket: "salonbookingsystem-d2296.firebasestorage.app",
      messagingSenderId: "51763851442",
      appId: "1:51763851442:web:3ebd2e1c6d84a24ac119ab"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // ========== Ù†Ø¸Ø§Ù… Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø­Ø³Ù† ==========

    /**
     * Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø·Ø±Ù‚ Ù…ØªØ¹Ø¯Ø¯Ø© Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ø¬Ù„Ø³Ø©
     */
    function saveUserData(userData) {
        try {
            // Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: localStorage (Ù„Ù„Ù…Ø¯Ù‰ Ø§Ù„Ø·ÙˆÙŠÙ„)
            localStorage.setItem("salonCurrentUser", JSON.stringify(userData));
            
            // Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: sessionStorage (Ù„Ù„Ù…Ø¯Ù‰ Ø§Ù„Ù‚ØµÙŠØ±)
            sessionStorage.setItem("salonCurrentUser", JSON.stringify(userData));
            
            // Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©: IndexedDB ÙƒØ¨Ø¯ÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠ
            if ('indexedDB' in window) {
                saveToIndexedDB(userData);
            }
            
            console.log("âœ… ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­ Ø¨Ø·Ø±Ù‚ Ù…ØªØ¹Ø¯Ø¯Ø©");
            return true;
        } catch (error) {
            console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:", error);
            return false;
        }
    }

    /**
     * Ø­ÙØ¸ ÙÙŠ IndexedDB
     */
    function saveToIndexedDB(userData) {
        const request = indexedDB.open("SalonAppDB", 1);
        
        request.onupgradeneeded = function(event) {
            const db = event.target.result;
            if (!db.objectStoreNames.contains('users')) {
                db.createObjectStore('users', { keyPath: 'userId' });
            }
        };
        
        request.onsuccess = function(event) {
            const db = event.target.result;
            const transaction = db.transaction(['users'], 'readwrite');
            const store = transaction.objectStore('users');
            store.put(userData);
        };
    }

    /**
     * Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„Ù…Ù…ÙƒÙ†Ø©
     */
    function getUserData() {
        let userData = null;
        
        try {
            // Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ù…Ù† localStorage
            const storedUser = localStorage.getItem("salonCurrentUser");
            if (storedUser) {
                userData = JSON.parse(storedUser);
                console.log("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† localStorage");
                return userData;
            }
            
            // Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: Ù…Ù† sessionStorage
            const sessionUser = sessionStorage.getItem("salonCurrentUser");
            if (sessionUser) {
                userData = JSON.parse(sessionUser);
                console.log("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† sessionStorage");
                // Ø¥Ø¹Ø§Ø¯Ø© Ø­ÙØ¸ ÙÙŠ localStorage Ù„Ù„Ù…Ø³ØªÙ‚Ø¨Ù„
                saveUserData(userData);
                return userData;
            }
            
            // Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©: Ù…Ù† IndexedDB
            if ('indexedDB' in window) {
                const indexedDBUser = getFromIndexedDB();
                if (indexedDBUser) {
                    userData = indexedDBUser;
                    console.log("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† IndexedDB");
                    // Ø¥Ø¹Ø§Ø¯Ø© Ø­ÙØ¸ ÙÙŠ localStorage Ùˆ sessionStorage
                    saveUserData(userData);
                    return userData;
                }
            }
        } catch (error) {
            console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:", error);
        }
        
        return null;
    }

    /**
     * Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ù…Ù† IndexedDB
     */
    function getFromIndexedDB() {
        return new Promise((resolve) => {
            const request = indexedDB.open("SalonAppDB", 1);
            
            request.onsuccess = function(event) {
                const db = event.target.result;
                const transaction = db.transaction(['users'], 'readonly');
                const store = transaction.objectStore('users');
                const getRequest = store.getAll();
                
                getRequest.onsuccess = function() {
                    if (getRequest.result.length > 0) {
                        resolve(getRequest.result[0]);
                    } else {
                        resolve(null);
                    }
                };
                
                getRequest.onerror = function() {
                    resolve(null);
                };
            };
            
            request.onerror = function() {
                resolve(null);
            };
        });
    }

    /**
     * Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØµØ§Ø¯Ø±
     */
    function clearUserData() {
        try {
            localStorage.removeItem("salonCurrentUser");
            sessionStorage.removeItem("salonCurrentUser");
            localStorage.removeItem("myBooking");
            
            // Ù…Ø³Ø­ Ù…Ù† IndexedDB
            if ('indexedDB' in window) {
                clearIndexedDB();
            }
            
            console.log("âœ… ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…");
        } catch (error) {
            console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:", error);
        }
    }

    function clearIndexedDB() {
        const request = indexedDB.open("SalonAppDB", 1);
        
        request.onsuccess = function(event) {
            const db = event.target.result;
            const transaction = db.transaction(['users'], 'readwrite');
            const store = transaction.objectStore('users');
            store.clear();
        };
    }

    /**
     * Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ ØµØ§Ù„Ø­Ø©
     */
    function checkStoredAuth() {
        const userData = getUserData();
        
        if (userData) {
            try {
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                if (userData && userData.name && userData.phone && userData.userId) {
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø¬Ù„Ø³Ø© Ù„Ù… ØªÙ†ØªÙ‡Ù
                    if (!isSessionExpired(userData)) {
                        console.log("âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„:", userData.name);
                        return userData;
                    } else {
                        console.log("âŒ Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¬Ù„Ø³Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…:", userData.name);
                        clearUserData();
                    }
                }
            } catch (e) {
                console.error("âŒ Error parsing stored user data:", e);
                clearUserData();
            }
        }
        
        return null;
    }

    /**
     * ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø¢Ø®Ø± Ù†Ø´Ø§Ø· Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
     */
    function updateUserActivity() {
        if (currentUser) {
            currentUser.lastActivity = new Date().toISOString();
            saveUserData(currentUser);
        }
    }

    /**
     * Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©
     */
    function isSessionExpired(user) {
        if (!user.lastActivity) return false;
        
        const lastActivity = new Date(user.lastActivity);
        const now = new Date();
        const hoursDiff = (now - lastActivity) / (1000 * 60 * 60);
        
        // Ø§Ù„Ø¬Ù„Ø³Ø© ØªÙ†ØªÙ‡ÙŠ Ø¨Ø¹Ø¯ 365 ÙŠÙˆÙ… (Ø³Ù†Ø© ÙƒØ§Ù…Ù„Ø©)
        const sessionDurationHours = 24 * 365;
        return hoursDiff > sessionDurationHours;
    }

    /**
     * Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø±Ù Ù…Ø³ØªØ®Ø¯Ù… ÙØ±ÙŠØ¯ Ø£ÙƒØ«Ø± Ù…ÙˆØ«ÙˆÙ‚ÙŠØ©
     */
    function generateUserId() {
        return 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    }

    // ========== Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ (ROUTING) ==========
    
    // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª
    const routes = {
      '/': {
        name: 'home',
        screen: 'mainScreen',
        navItem: 'navHome',
        authRequired: true
      },
      '/bookings': {
        name: 'bookings', 
        screen: 'bookingsScreen',
        navItem: 'navBookings',
        authRequired: true
      },
      '/profile': {
        name: 'profile',
        screen: 'profileScreen', 
        navItem: 'navProfile',
        authRequired: true
      },
      '/login': {
        name: 'login',
        screen: 'loginScreen',
        authRequired: false
      }
    };

    // Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ
    let currentRoute = '/';

    /**
     * ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙˆØ¬ÙŠÙ‡
     */
    function initRouter() {
      // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹/Ø§Ù„ØªÙ‚Ø¯Ù… ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­
      window.addEventListener('popstate', (event) => {
        if (event.state && event.state.route) {
          navigateTo(event.state.route, false);
        }
      });

      // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªÙ†Ù‚Ù„
      document.querySelectorAll('.nav-item[data-route]').forEach(item => {
        item.addEventListener('click', (e) => {
          e.preventDefault();
          const route = item.getAttribute('data-route');
          navigateTo(route);
        });
      });

      // Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø£ÙˆÙ„ÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø· Ø£Ùˆ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
      const initialRoute = window.location.hash.replace('#', '') || '/';
      navigateTo(initialRoute, false);
    }

    /**
     * Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ù…Ø³Ø§Ø± Ù…Ø­Ø¯Ø¯
     * @param {string} route - Ù…Ø³Ø§Ø± Ø§Ù„ÙˆØ¬Ù‡Ø©
     * @param {boolean} pushState - Ù‡Ù„ ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø³Ø¬Ù„ Ø§Ù„Ù…ØªØµÙØ­
     */
    function navigateTo(route, pushState = true) {
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ø³Ø§Ø±
      if (!routes[route]) {
        route = '/';
      }

      const routeConfig = routes[route];
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
      if (routeConfig.authRequired && !currentUser) {
        console.log("âŒ ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ØŒ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ /login");
        navigateTo('/login', pushState);
        return;
      }

      // ØªØ­Ø¯ÙŠØ« Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ØªØµÙØ­ Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
      if (pushState) {
        window.history.pushState({ route }, '', `#${route}`);
      }

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ
      currentRoute = route;
      
      // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø£ÙˆÙ„Ø§Ù‹
      document.querySelectorAll('.screen, .login-screen').forEach(screen => {
        screen.style.display = 'none';
        screen.classList.remove('active');
      });

      // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©
      const targetScreen = document.getElementById(routeConfig.screen);
      if (targetScreen) {
        targetScreen.style.display = 'flex';
        targetScreen.classList.add('active');
        
        // ØªÙ‡ÙŠØ¦Ø© Ø®Ø§ØµØ© Ù„ÙƒÙ„ Ù…Ø³Ø§Ø±
        initializeRoute(route);
      }

      // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ù†Ø´Ø·
      updateNavActive(routeConfig.navItem);
    }

    /**
     * ØªÙ‡ÙŠØ¦Ø© Ù…Ø³Ø§Ø± Ù…Ø­Ø¯Ø¯
     * @param {string} route - Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¯ ØªÙ‡ÙŠØ¦ØªÙ‡
     */
    function initializeRoute(route) {
      switch(route) {
        case '/':
          initializeHomeScreen();
          break;
        case '/bookings':
          initializeBookingsScreen();
          break;
        case '/profile':
          initializeProfileScreen();
          break;
        case '/login':
          initializeLoginScreen();
          break;
      }
    }

    /**
     * ØªÙ‡ÙŠØ¦Ø© Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
     */
    function initializeHomeScreen() {
      if (currentUser) {
        nameInput.value = currentUser.name;
        populateDays();
        populateHours();
        updateCharCounter(nameInput, nameCounter, 50);
      }
    }

    /**
     * ØªÙ‡ÙŠØ¦Ø© Ø´Ø§Ø´Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª
     */
    function initializeBookingsScreen() {
      loadUserBookings();
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ù„Ø§ÙØªØ© Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ù†Ø´Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
      if (myBooking) {
        activeBookingBanner.classList.remove("hidden");
        activeBookingBanner.onclick = () => showDetails(myBooking);
      } else {
        activeBookingBanner.classList.add("hidden");
      }
    }

    /**
     * ØªÙ‡ÙŠØ¦Ø© Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
     */
    function initializeProfileScreen() {
      profileName.textContent = currentUser.name;
      profilePhone.textContent = currentUser.phone;
      editProfileForm.classList.add("hidden");
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
      resetSettingsIcons();
    }

    /**
     * ØªÙ‡ÙŠØ¦Ø© Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
     */
    function initializeLoginScreen() {
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
      loginForm.reset();
      updateCharCounter(userName, userNameCounter, 50);
      updateCharCounter(userPhone, userPhoneCounter, 11);
    }

    /**
     * ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ù†Ø´Ø·
     * @param {string} activeId - Ù…Ø¹Ø±Ù Ø¹Ù†ØµØ± Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ù†Ø´Ø·
     */
    function updateNavActive(activeId) {
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });
      
      if (activeId) {
        const activeItem = document.getElementById(activeId);
        if (activeItem) {
          activeItem.classList.add('active');
        }
      }
    }

    // ========== Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ==========
    
    /**
     * Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ ÙˆÙÙ‚Ù‹Ø§ Ù„Ø°Ù„Ùƒ
     */
    function checkAuthStatus() {
      const storedUser = checkStoredAuth();
      
      if (storedUser && !isSessionExpired(storedUser)) {
        currentUser = storedUser;
        updateUserActivity(); // ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø§Ù„Ù†Ø´Ø§Ø·
        
        console.log("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø³Ø¬Ù„:", currentUser.name);
        
        if (currentRoute === '/login') {
          navigateTo('/');
        } else {
          navigateTo(currentRoute, false);
        }
        bottomNav.style.display = "flex";
      } else {
        // Ø¥Ø°Ø§ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬Ù„Ø³Ø© Ø£Ùˆ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ØŒ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
        if (storedUser && isSessionExpired(storedUser)) {
          clearUserData();
        }
        
        console.log("âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ØŒ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");
        navigateTo('/login', false);
        bottomNav.style.display = "none";
      }
    }

    /**
     * ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡
     */
    function loginUser(name, phone) {
      const userId = generateUserId();
      
      currentUser = { 
        name, 
        phone, 
        userId: userId,
        loginTime: new Date().toISOString(),
        lastActivity: new Date().toISOString(),
        sessionId: 'session_' + Math.random().toString(36).substr(2, 9)
      };
      
      // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ø±Ù‚
      const saveResult = saveUserData(currentUser);
      
      if (saveResult) {
        showToast(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${name}!`);
        console.log("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­ ÙˆØ­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
        
        // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        navigateTo('/');
        bottomNav.style.display = "flex";
      } else {
        showToast("âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø©");
        console.error("âŒ ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø©");
      }
    }

    /**
     * ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
     */
    function logoutUser() {
      console.log("ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬...");
      
      currentUser = null;
      clearUserData();
      
      showToast("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­");
      navigateTo('/login');
      bottomNav.style.display = "none";
    }

    // Ø¹Ù†Ø§ØµØ± DOM
    const loginScreen = document.getElementById("loginScreen");
    const mainScreen = document.getElementById("mainScreen");
    const profileScreen = document.getElementById("profileScreen");
    const bookingsScreen = document.getElementById("bookingsScreen");
    const bottomNav = document.getElementById("bottomNav");
    const navHome = document.getElementById("navHome");
    const navProfile = document.getElementById("navProfile");
    const navBookings = document.getElementById("navBookings");
    const confirmEdit = document.getElementById("confirmEdit");
    const updateProfileForm = document.getElementById("updateProfileForm");
    const editProfileForm = document.getElementById("editProfileForm");
    const profileName = document.getElementById("profileName");
    const profilePhone = document.getElementById("profilePhone");
    const editName = document.getElementById("editName");
    const editPhone = document.getElementById("editPhone");
    const loginForm = document.getElementById("loginForm");
    const userName = document.getElementById("userName");
    const userPhone = document.getElementById("userPhone");
    const bookingsList = document.getElementById("bookingsList");
    const noBookingsMessage = document.getElementById("noBookingsMessage");
    const settingsBtn = document.getElementById("settingsBtn");
    const confirmSaveBtn = document.getElementById("confirmSaveBtn");
    const activeBookingBanner = document.getElementById("activeBookingBanner");
    const loginBtn = document.getElementById("loginBtn");
    const submitBtn = document.getElementById("submitBtn");
    const confirmationModal = document.getElementById("confirmationModal");
    const confirmYes = document.getElementById("confirmYes");
    const confirmNo = document.getElementById("confirmNo");
    const logoutBtn = document.getElementById("logoutBtn");
    
    // Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø­Ø±Ù
    const userNameCounter = document.getElementById("userNameCounter");
    const userPhoneCounter = document.getElementById("userPhoneCounter");
    const nameCounter = document.getElementById("nameCounter");
    const editNameCounter = document.getElementById("editNameCounter");
    const editPhoneCounter = document.getElementById("editPhoneCounter");
    
    // Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø·Ø£
    const userNameError = document.getElementById("userNameError");
    const userPhoneError = document.getElementById("userPhoneError");
    const nameError = document.getElementById("nameError");
    const editNameError = document.getElementById("editNameError");
    const editPhoneError = document.getElementById("editPhoneError");
    
    // Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£ØµÙ„ÙŠØ© Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù…
    const days = ["Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡","Ø§Ù„Ø®Ù…ÙŠØ³","Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø§Ù„Ø³Ø¨Øª"];
    const daysSelect = document.getElementById("day");
    const hoursSelect = document.getElementById("hour");
    const toast = document.getElementById("successToast");
    const details = document.getElementById("detailsCard");
    const form = document.getElementById("bookingForm");
    const nameInput = document.getElementById("name");

    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    let currentUser = null;
    let myBooking = JSON.parse(localStorage.getItem("myBooking")) || null;
    let bookingToCancel = null;
    let currentBookings = {};

    // ========== ÙˆØ¸Ø§Ø¦Ù ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª ==========
    
    /**
     * ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„ØªØ£ÙƒÙŠØ¯
     */
    function switchToConfirmIcon() {
      settingsBtn.style.display = 'none';
      confirmSaveBtn.style.display = 'flex';
    }

    /**
     * ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ù† Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
     */
    function switchToSettingsIcon() {
      confirmSaveBtn.style.display = 'none';
      settingsBtn.style.display = 'flex';
    }

    /**
     * Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
     */
    function resetSettingsIcons() {
      switchToSettingsIcon();
    }

    /**
     * Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­ Ø§Ù„ØªØ­Ø¯ÙŠØ«
     */
    function showUpdateSuccess() {
      showToast("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ âœ“");
    }

    // ========== Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ==========
    
    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    loginForm.addEventListener("submit", e => {
      e.preventDefault();
      
      if (!validateLoginForm()) {
        showToast("ÙŠØ±Ø¬Ù‰ ØªØµØ­ÙŠØ­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬");
        return;
      }
      
      const name = userName.value.trim();
      const phone = userPhone.value.trim();
      
      if (!name || !phone) return;
      
      loginUser(name, phone);
    });

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
    logoutBtn.addEventListener("click", logoutUser);

    // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ - Ø²Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    settingsBtn.addEventListener("click", () => {
      editName.value = currentUser.name;
      editPhone.value = currentUser.phone;
      updateCharCounter(editName, editNameCounter, 50);
      updateCharCounter(editPhone, editPhoneCounter, 11);
      editProfileForm.classList.remove("hidden");
      
      // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¥Ù„Ù‰ Ø§Ù„ØªØ£ÙƒÙŠØ¯
      switchToConfirmIcon();
    });

    // Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª - Ø²Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯
    confirmSaveBtn.addEventListener("click", () => {
      if (!validateEditProfileForm()) {
        showToast("ÙŠØ±Ø¬Ù‰ ØªØµØ­ÙŠØ­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬");
        return;
      }
      
      const newName = editName.value.trim();
      const newPhone = editPhone.value.trim();
      
      if (!newName || !newPhone) return;
      
      currentUser.name = newName;
      currentUser.phone = newPhone;
      saveUserData(currentUser);
      
      nameInput.value = newName;
      updateCharCounter(nameInput, nameCounter, 50);
      
      profileName.textContent = newName;
      profilePhone.textContent = newPhone;
      
      editProfileForm.classList.add("hidden");
      
      // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
      switchToSettingsIcon();
      
      // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
      showUpdateSuccess();
    });

    // Ø²Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø¯Ø§Ø®Ù„ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
    confirmEdit.addEventListener("click", () => {
      if (!validateEditProfileForm()) {
        showToast("ÙŠØ±Ø¬Ù‰ ØªØµØ­ÙŠØ­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬");
        return;
      }
      
      const newName = editName.value.trim();
      const newPhone = editPhone.value.trim();
      
      if (!newName || !newPhone) return;
      
      currentUser.name = newName;
      currentUser.phone = newPhone;
      saveUserData(currentUser);
      
      nameInput.value = newName;
      updateCharCounter(nameInput, nameCounter, 50);
      
      profileName.textContent = newName;
      profilePhone.textContent = newPhone;
      
      editProfileForm.classList.add("hidden");
      
      // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
      switchToSettingsIcon();
      
      // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
      showUpdateSuccess();
    });

    // ========== ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ==========
    
    /**
     * Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø§Ø³Ù… (Ø£Ø­Ø±Ù Ø¹Ø±Ø¨ÙŠØ© ÙÙ‚Ø·)
     * @param {string} name - Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø§Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù†Ù‡
     * @returns {boolean} - ØµØ­ÙŠØ­ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø§Ø³Ù… ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø­Ø±Ù Ø¹Ø±Ø¨ÙŠØ© ÙÙ‚Ø·
     */
    function isValidName(name) {
      // Ø§Ù„Ù†Ù…Ø· ÙŠØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø£Ø­Ø±Ù Ø¹Ø±Ø¨ÙŠØ© ÙÙ‚Ø· (Ø¨Ù…Ø§ ÙÙŠ Ø°Ù„Ùƒ Ø§Ù„Ù‡Ù…Ø²Ø§Øª ÙˆØ§Ù„ØªØ´ÙƒÙŠÙ„)
      const arabicPattern = /^[\u0600-\u06FF\s]+$/;
      return arabicPattern.test(name);
    }

    /**
     * Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø·ÙˆÙ„ Ø§Ù„Ø§Ø³Ù… (Ø¨ÙŠÙ† 7 Ùˆ50 Ø­Ø±Ù)
     * @param {string} name - Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø§Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù†Ù‡
     * @returns {boolean} - ØµØ­ÙŠØ­ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø§Ø³Ù… Ø¨ÙŠÙ† 7 Ùˆ50 Ø­Ø±Ù
     */
    function isValidNameLength(name) {
      return name.length >= 7 && name.length <= 50;
    }

    /**
     * Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·)
     * @param {string} phone - Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø±Ø§Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù†Ù‡
     * @returns {boolean} - ØµØ­ÙŠØ­ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·
     */
    function isValidPhone(phone) {
      // Ø§Ù„Ù†Ù…Ø· ÙŠØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·
      const phonePattern = /^[0-9]+$/;
      return phonePattern.test(phone);
    }

    /**
     * Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø·ÙˆÙ„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (11 Ø±Ù‚Ù… Ø¨Ø§Ù„Ø¶Ø¨Ø·)
     * @param {string} phone - Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø±Ø§Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù†Ù‡
     * @returns {boolean} - ØµØ­ÙŠØ­ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ 11 Ø±Ù‚Ù…
     */
    function isValidPhoneLength(phone) {
      return phone.length === 11;
    }

    /**
     * Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø­Ø¬Ø²
     * @returns {boolean} - ØµØ­ÙŠØ­ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ØµØ§Ù„Ø­Ø§Ù‹
     */
    function validateBookingForm() {
      const name = nameInput.value.trim();
      const service = document.getElementById("service").value;
      const day = daysSelect.value;
      const hour = hoursSelect.value;
      
      let isValid = true;
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø³Ù…
      if (!isValidName(name) || !isValidNameLength(name)) {
        nameInput.classList.add("invalid");
        nameError.style.display = "block";
        isValid = false;
      } else {
        nameInput.classList.remove("invalid");
        nameInput.classList.add("valid");
        nameError.style.display = "none";
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø®Ø¯Ù…Ø©
      if (!service) {
        document.getElementById("service").classList.add("invalid");
        isValid = false;
      } else {
        document.getElementById("service").classList.remove("invalid");
        document.getElementById("service").classList.add("valid");
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙŠÙˆÙ…
      if (!day) {
        daysSelect.classList.add("invalid");
        isValid = false;
      } else {
        daysSelect.classList.remove("invalid");
        daysSelect.classList.add("valid");
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø³Ø§Ø¹Ø©
      if (!hour) {
        hoursSelect.classList.add("invalid");
        isValid = false;
      } else {
        hoursSelect.classList.remove("invalid");
        hoursSelect.classList.add("valid");
      }
      
      return isValid;
    }

    /**
     * Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
     * @returns {boolean} - ØµØ­ÙŠØ­ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ØµØ§Ù„Ø­Ø§Ù‹
     */
    function validateLoginForm() {
      const name = userName.value.trim();
      const phone = userPhone.value.trim();
      
      let isValid = true;
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø³Ù…
      if (!isValidName(name) || !isValidNameLength(name)) {
        userName.classList.add("invalid");
        userNameError.style.display = "block";
        isValid = false;
      } else {
        userName.classList.remove("invalid");
        userName.classList.add("valid");
        userNameError.style.display = "none";
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
      if (!isValidPhone(phone) || !isValidPhoneLength(phone)) {
        userPhone.classList.add("invalid");
        userPhoneError.style.display = "block";
        isValid = false;
      } else {
        userPhone.classList.remove("invalid");
        userPhone.classList.add("valid");
        userPhoneError.style.display = "none";
      }
      
      return isValid;
    }

    /**
     * Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ù†Ù…ÙˆØ°Ø¬ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
     * @returns {boolean} - ØµØ­ÙŠØ­ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ØµØ§Ù„Ø­Ø§Ù‹
     */
    function validateEditProfileForm() {
      const name = editName.value.trim();
      const phone = editPhone.value.trim();
      
      let isValid = true;
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø³Ù…
      if (!isValidName(name) || !isValidNameLength(name)) {
        editName.classList.add("invalid");
        editNameError.style.display = "block";
        isValid = false;
      } else {
        editName.classList.remove("invalid");
        editName.classList.add("valid");
        editNameError.style.display = "none";
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
      if (!isValidPhone(phone) || !isValidPhoneLength(phone)) {
        editPhone.classList.add("invalid");
        editPhoneError.style.display = "block";
        isValid = false;
      } else {
        editPhone.classList.remove("invalid");
        editPhone.classList.add("valid");
        editPhoneError.style.display = "none";
      }
      
      return isValid;
    }

    // ========== ÙˆØ¸Ø§Ø¦Ù Ù…Ù†Ø¹ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ØºÙŠØ± Ø§Ù„Ù…Ø±ØºÙˆØ¨ ==========
    
    /**
     * Ù…Ù†Ø¹ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙŠ Ø­Ù‚Ù„ Ø§Ù„Ø§Ø³Ù…
     * @param {Event} e - Ø­Ø¯Ø« Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
     */
    function preventNumbersInName(e) {
      // Ù…Ù†Ø¹ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙˆØ§Ù„Ø±Ù…ÙˆØ² Ø§Ù„Ø®Ø§ØµØ©
      if (e.key >= '0' && e.key <= '9') {
        e.preventDefault();
        return;
      }
      
      // Ù…Ù†Ø¹ Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ø§Ù„Ù…Ø³Ø§ÙØ©
      const allowedKeys = ['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'Tab', ' '];
      if (!allowedKeys.includes(e.key) && !/^[\u0600-\u06FF]$/.test(e.key)) {
        e.preventDefault();
      }
    }
    
    /**
     * Ù…Ù†Ø¹ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø­Ø±ÙˆÙ ÙÙŠ Ø­Ù‚Ù„ Ø§Ù„Ù‡Ø§ØªÙ
     * @param {Event} e - Ø­Ø¯Ø« Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
     */
    function preventLettersInPhone(e) {
      // Ø§Ù„Ø³Ù…Ø§Ø­ ÙÙ‚Ø· Ø¨Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙˆÙ…ÙØ§ØªÙŠØ­ Ø§Ù„ØªØ­ÙƒÙ…
      const allowedKeys = ['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'Tab'];
      if (!allowedKeys.includes(e.key) && !(e.key >= '0' && e.key <= '9')) {
        e.preventDefault();
      }
    }
    
    /**
     * ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø­Ø±Ù
     * @param {HTMLInputElement} input - Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
     * @param {HTMLElement} counter - Ø¹Ù†ØµØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯
     * @param {number} maxLength - Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø£Ø­Ø±Ù
     */
    function updateCharCounter(input, counter, maxLength) {
      const length = input.value.length;
      counter.textContent = `${length}/${maxLength}`;
      
      // ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø·ÙˆÙ„
      if (length > maxLength) {
        counter.style.color = 'var(--error)';
      } else if (length >= 7 && maxLength === 50) {
        counter.style.color = 'var(--accent)';
      } else if (length === 11 && maxLength === 11) {
        counter.style.color = 'var(--accent)';
      } else {
        counter.style.color = 'var(--accent)';
      }
    }

    // ========== Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ÙÙˆØ±ÙŠ ==========
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ÙÙˆØ±ÙŠ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙÙŠ Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    userName.addEventListener("input", () => {
      const name = userName.value.trim();
      updateCharCounter(userName, userNameCounter, 50);
      
      if (name && (!isValidName(name) || !isValidNameLength(name))) {
        userName.classList.add("invalid");
        userNameError.style.display = "block";
      } else {
        userName.classList.remove("invalid");
        userName.classList.add("valid");
        userNameError.style.display = "none";
      }
    });

    // Ù…Ù†Ø¹ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙŠ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    userName.addEventListener("keydown", preventNumbersInName);

    userPhone.addEventListener("input", () => {
      const phone = userPhone.value.trim();
      updateCharCounter(userPhone, userPhoneCounter, 11);
      
      if (phone && (!isValidPhone(phone) || !isValidPhoneLength(phone))) {
        userPhone.classList.add("invalid");
        userPhoneError.style.display = "block";
      } else {
        userPhone.classList.remove("invalid");
        userPhone.classList.add("valid");
        userPhoneError.style.display = "none";
      }
    });

    // Ù…Ù†Ø¹ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø­Ø±ÙˆÙ ÙÙŠ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
    userPhone.addEventListener("keydown", preventLettersInPhone);

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ÙÙˆØ±ÙŠ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙÙŠ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø­Ø¬Ø²
    nameInput.addEventListener("input", () => {
      const name = nameInput.value.trim();
      updateCharCounter(nameInput, nameCounter, 50);
      
      if (name && (!isValidName(name) || !isValidNameLength(name))) {
        nameInput.classList.add("invalid");
        nameError.style.display = "block";
      } else {
        nameInput.classList.remove("invalid");
        nameInput.classList.add("valid");
        nameError.style.display = "none";
      }
    });

    // Ù…Ù†Ø¹ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙŠ Ø§Ø³Ù… Ø§Ù„Ø­Ø¬Ø²
    nameInput.addEventListener("keydown", preventNumbersInName);

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ÙÙˆØ±ÙŠ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙÙŠ Ù†Ù…ÙˆØ°Ø¬ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
    editName.addEventListener("input", () => {
      const name = editName.value.trim();
      updateCharCounter(editName, editNameCounter, 50);
      
      if (name && (!isValidName(name) || !isValidNameLength(name))) {
        editName.classList.add("invalid");
        editNameError.style.display = "block";
      } else {
        editName.classList.remove("invalid");
        editName.classList.add("valid");
        editNameError.style.display = "none";
      }
    });

    // Ù…Ù†Ø¹ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙŠ Ø§Ø³Ù… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
    editName.addEventListener("keydown", preventNumbersInName);

    editPhone.addEventListener("input", () => {
      const phone = editPhone.value.trim();
      updateCharCounter(editPhone, editPhoneCounter, 11);
      
      if (phone && (!isValidPhone(phone) || !isValidPhoneLength(phone))) {
        editPhone.classList.add("invalid");
        editPhoneError.style.display = "block";
      } else {
        editPhone.classList.remove("invalid");
        editPhone.classList.add("valid");
        editPhoneError.style.display = "none";
      }
    });

    // Ù…Ù†Ø¹ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø­Ø±ÙˆÙ ÙÙŠ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„
    editPhone.addEventListener("keydown", preventLettersInPhone);

    // ========== ÙˆØ¸Ø§Ø¦Ù Ø¹Ø§Ù…Ø© ==========
    
    function showToast(msg) {
      toast.textContent = msg;
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 3000);
    }

    // ========== ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø­Ø¬Ø² ==========
    
    function populateDays() {
      daysSelect.innerHTML = "<option value=''>Ø§Ø®ØªØ± Ø§Ù„ÙŠÙˆÙ…</option>";
      const today = new Date();
      for (let i = 0; i < 7; i++) {
        const d = new Date();
        d.setDate(today.getDate() + i);
        const val = d.toISOString().slice(0, 10);
        const opt = document.createElement("option");
        opt.value = val;
        opt.textContent = `${days[d.getDay()]} (${d.getDate()}/${d.getMonth() + 1})`;
        daysSelect.appendChild(opt);
      }
    }

    function populateHours() {
      hoursSelect.innerHTML = "<option value=''>Ø§Ø®ØªØ± Ø§Ù„Ø³Ø§Ø¹Ø©</option>";
      for (let h = 9; h <= 21; h++) {
        const opt = document.createElement("option");
        opt.value = `${h}:00`;
        opt.textContent = `${h}:00`;
        hoursSelect.appendChild(opt);
      }
    }

    const bookingsRef = ref(db, "bookings");

    onValue(bookingsRef, snap => {
      currentBookings = snap.val() || {};
      updateHours();
      if (myBooking && !currentBookings[myBooking.slotKey]) {
        showToast("ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø­Ø¬Ø²Ùƒ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„ØµØ§Ù„ÙˆÙ†");
        localStorage.removeItem("myBooking");
        myBooking = null;
        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© - Ø­Ø³Ø¨ Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        details.style.display = "none";
        activeBookingBanner.classList.add("hidden");
      }
    });

    function updateHours() {
      const selectedDay = daysSelect.value;
      if (!selectedDay) return;

      const now = new Date();
      const todayISO = now.toISOString().slice(0, 10);

      hoursSelect.querySelectorAll("option").forEach(opt => {
        if (!opt.value) return;
        const key = `${selectedDay}_${opt.value}`;
        const [hour] = opt.value.split(":");
        const isPast = (selectedDay === todayISO && parseInt(hour) <= now.getHours());
        opt.disabled = currentBookings[key] || isPast;
        opt.style.opacity = opt.disabled ? ".4" : "1";
      });
    }

    daysSelect.addEventListener("change", updateHours);

    form.addEventListener("submit", async e => {
      e.preventDefault();

      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
      if (!validateBookingForm()) {
        showToast("ÙŠØ±Ø¬Ù‰ ØªØµØ­ÙŠØ­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬");
        return;
      }

      const name = document.getElementById("name").value.trim();
      const service = document.getElementById("service").value;
      const day = daysSelect.value;
      const hour = hoursSelect.value;

      if (!name || !service || !day || !hour) return;
      const slotKey = `${day}_${hour}`;

      if (currentBookings[slotKey]) return alert("Ø¹Ø°Ø±Ù‹Ø§ØŒ Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ù…Ø­Ø¬ÙˆØ².");

      const bookingId = Date.now().toString();

      // Ø¥Ø¶Ø§ÙØ© Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø¥Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø²
      await set(ref(db, `bookings/${slotKey}/${bookingId}`), {
        name,
        service,
        phone: currentUser.phone,
        timestamp: new Date().toISOString(),
        userId: currentUser.userId
      });

      myBooking = { name, service, day, hour, slotKey, bookingId };
      localStorage.setItem("myBooking", JSON.stringify(myBooking));

      showToast("ØªÙ… Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­ âœ¨");
      form.reset();
      nameInput.value = currentUser.name;
      updateCharCounter(nameInput, nameCounter, 50);
      populateDays();
      populateHours();
    });

    function showDetails(b) {
      const d = new Date(b.day);
      details.innerHTML = `
        <h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²</h3>
        <p><b>Ø§Ù„Ø§Ø³Ù…:</b> ${b.name}</p>
        <div class="phone-display">ğŸ“ ${currentUser.phone}</div>
        <p><b>Ø§Ù„Ø®Ø¯Ù…Ø©:</b> ${b.service}</p>
        <p><b>Ø§Ù„ÙŠÙˆÙ…:</b> ${days[d.getDay()]} (${d.getDate()}/${d.getMonth() + 1})</p>
        <p><b>Ø§Ù„Ø³Ø§Ø¹Ø©:</b> ${b.hour}</p>
        <div class="booking-status">âœ… Ù…ÙˆØ¹Ø¯ Ù‚Ø§Ø¯Ù…</div>
        <button class="cancel-btn" id="cancelBtn">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¬Ø²</button>
      `;
      details.style.display = "block";
      document.getElementById("cancelBtn").onclick = () => cancelBooking(b);
    }

    // ========== ÙˆØ¸Ø§Ø¦Ù Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¬Ø² ==========
    
    /**
     * Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ù„ØºØ§Ø¡
     * @param {Object} booking - Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¥Ù„ØºØ§Ø¤Ù‡
     */
    function showCancelConfirmation(booking) {
      bookingToCancel = booking;
      confirmationModal.style.display = "flex";
    }

    /**
     * Ø¥Ø®ÙØ§Ø¡ Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ù„ØºØ§Ø¡
     */
    function hideCancelConfirmation() {
      confirmationModal.style.display = "none";
      bookingToCancel = null;
    }

    /**
     * ØªÙ†ÙÙŠØ° Ø¹Ù…Ù„ÙŠØ© Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¬Ø²
     */
    async function executeCancelBooking() {
      if (!bookingToCancel) return;
      
      await remove(ref(db, `bookings/${bookingToCancel.slotKey}/${bookingToCancel.bookingId}`));
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ù†Ø´Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ùˆ Ù†ÙØ³Ù‡ Ø§Ù„Ø°ÙŠ ØªÙ… Ø¥Ù„ØºØ§Ø¤Ù‡
      if (myBooking && myBooking.bookingId === bookingToCancel.bookingId) {
        localStorage.removeItem("myBooking");
        myBooking = null;
        activeBookingBanner.classList.add("hidden");
      }
      
      showToast("ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¬Ø² âŒ");
      hideCancelConfirmation();
      loadUserBookings(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª
      updateHours(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
    }

    // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯
    confirmYes.addEventListener("click", executeCancelBooking);
    confirmNo.addEventListener("click", hideCancelConfirmation);

    // ========== ØªØ­Ù…ÙŠÙ„ Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ==========
    
    function loadUserBookings() {
      bookingsList.innerHTML = "";
      
      if (!currentBookings || Object.keys(currentBookings).length === 0) {
        noBookingsMessage.classList.remove("hidden");
        return;
      }
      
      const userBookings = [];
      
      for (const slotKey in currentBookings) {
        for (const bookingId in currentBookings[slotKey]) {
          const booking = currentBookings[slotKey][bookingId];
          if (booking.userId === currentUser.userId) {
            const [dayISO, time] = slotKey.split("_");
            userBookings.push({
              ...booking,
              slotKey,
              bookingId,
              dayISO,
              time
            });
          }
        }
      }
      
      if (userBookings.length === 0) {
        noBookingsMessage.classList.remove("hidden");
        return;
      }
      
      noBookingsMessage.classList.add("hidden");
      
      userBookings.forEach(booking => {
        const d = new Date(booking.dayISO);
        const bookingItem = document.createElement("div");
        bookingItem.className = "booking-item";
        
        // ØªØ­Ø¯ÙŠØ¯ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø² Ù‡Ùˆ Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ù†Ø´Ø·
        const isActiveBooking = myBooking && myBooking.bookingId === booking.bookingId;
        
        bookingItem.innerHTML = `
          <p><b>Ø§Ù„Ø®Ø¯Ù…Ø©:</b> ${booking.service}</p>
          <p><b>Ø§Ù„ÙŠÙˆÙ…:</b> ${days[d.getDay()]} (${d.getDate()}/${d.getMonth() + 1})</p>
          <p><b>Ø§Ù„Ø³Ø§Ø¹Ø©:</b> ${booking.time}</p>
          ${isActiveBooking ? '<div class="booking-status">âœ… Ù…ÙˆØ¹Ø¯ Ù‚Ø§Ø¯Ù…</div>' : ''}
          <button class="booking-cancel-btn" data-booking='${JSON.stringify(booking).replace(/'/g, "&#39;")}'>Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¬Ø²</button>
        `;
        
        // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ø­Ø¯Ø« Ù„Ø²Ø± Ø§Ù„Ø¥Ù„ØºØ§Ø¡
        const cancelBtn = bookingItem.querySelector('.booking-cancel-btn');
        cancelBtn.addEventListener('click', function() {
          const bookingData = JSON.parse(this.getAttribute('data-booking'));
          showCancelConfirmation(bookingData);
        });
        
        bookingsList.appendChild(bookingItem);
      });
    }

    // ========== ØªÙ‡ÙŠØ¦Ø© Ø£ÙˆÙ„ÙŠØ© ==========
    
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    function initApp() {
      console.log("ğŸš€ Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚...");
      
      // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹
      const storedUser = checkStoredAuth();
      if (storedUser && !isSessionExpired(storedUser)) {
        currentUser = storedUser;
        updateUserActivity();
        console.log("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø³Ø¬Ù„:", currentUser.name);
      } else {
        console.log("âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„");
      }
      
      initRouter(); // ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø£ÙˆÙ„Ø§Ù‹
      checkAuthStatus(); // Ø«Ù… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
      
      // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø´Ø§Ø·
      document.addEventListener('click', updateUserActivity);
      document.addEventListener('touchstart', updateUserActivity);
      document.addEventListener('keypress', updateUserActivity);
      
      console.log("âœ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…");
    }

    // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    document.addEventListener('DOMContentLoaded', function() {
      console.log("ğŸ“„ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„");
      initApp();
    });
  </script>
</body>
</html>
